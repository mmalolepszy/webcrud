function ApplicationController(){function e(){var e=$.cookie("locale")||"en-GB";return e in $.datepicker.regional||-1==e.indexOf("-")||(e=e.substr(0,e.indexOf("-"))),e in $.datepicker.regional||(e="en-GB"),e}var r,t=this;t.setCulture=function(e){Globalize.culture(e),Messages.translations.hasOwnProperty(e)&&(r=e),t.messages=Messages.translations[r]},t.showConfirmation=function(e,r,a,o){r=r||"Confirmation",a=a||function(){},o=o||function(){},$("#dialog-confirm").attr("title",r),$("#dialog-confirm-text").text(e),$("#dialog-confirm").dialog({resizable:!1,draggable:!1,modal:!0,buttons:[{text:t.messages.yes,"class":"btn btn-primary",click:function(){$(this).dialog("close"),a()}},{text:t.messages.no,"class":"btn",click:function(){$(this).dialog("close"),o()}}]})},t.showError=function(e,r){r=r||"Error",$("#dialog-error").attr("title",r),$("#dialog-error-text").text(e),$("#dialog-error").dialog({resizable:!1,draggable:!1,modal:!0,buttons:[{text:t.messages.ok,"class":"btn btn-primary",click:function(){$(this).dialog("close")}}]})},t.initializeDatepickers=function(r){$.datepicker.setDefaults($.datepicker.regional[""]);var t=e();null!=r?r.datepicker($.datepicker.regional[t]):$(".datepicker, .date").datepicker($.datepicker.regional[t])},t.init=function(){t.initializeDatepickers(),t.setCulture("en-GB")}}function OrderFormController(e,r){var t=this,a=e;t.addBlankRow=function(e){return $.ajax({url:Application.Routes.Orders.AddBlankOrderItem,cache:!1,success:function(e){$("#orderItems tbody").append(e),$.validator.unobtrusive.rebindForm()}}),!1},t.deleteOrderItem=function(e){var r=$(this).parents("tr:first");return recalculateTotalAmount(r),r.remove(),!1},t.onProductChanged=function(e){var r=$(this).parents("tr:first");$.getJSON(Application.Routes.Orders.GetProductDetails,{productId:$(this).val()},function(e){reloadProductData(r,e)})},t.onQuantityOrDiscountChanged=function(e){var r=$(this).parents("tr:first");recalculateTotalAmount(r)},t.init=function(){a==OrderFormController.OrderFormControllerModes.EDIT?($("#OrderForm_OrderNumber").attr("readonly","readonly"),$("#OrderForm_Date").attr("readonly","readonly")):a==OrderFormController.OrderFormControllerModes.CREATE&&($("#OrderForm_Status").attr("readonly","readonly"),$("#OrderForm_Date").addClass("datepicker date"),Application.initializeDatepickers($("#OrderForm_Date"))),$("#addBlankOrderItem").on("click",t.addBlankRow),$("#orderItems tbody").on("click","a.removeOrderItem",t.deleteOrderItem),$("#orderItems tbody").on("change","select.productSelector",t.onProductChanged),$("#orderItems tbody").on("change","input.quantityInput",t.onQuantityOrDiscountChanged),$("#orderItems tbody").on("change","input.discountInput",t.onQuantityOrDiscountChanged),initCustomerAutocomplete(),$.validator.unobtrusive.setupBootstrapValidation($("form#OrderForm")),recalculateOrderTotalAmount()}}function reloadProductData(e,r){e.find("input.priceInput").val(r.Price),e.find("input.quantityInput").val(1),e.find("input.discountInput").val(0),recalculateTotalAmount(e)}function recalculateTotalAmount(e){var r=e.find("input.priceInput").val(),t=e.find("input.quantityInput").val(),a=e.find("input.discountInput").val(),o=r*t,i=o-o*a/100;i=Math.round(100*i)/100,e.find("input.totalAmountInput").val(i),recalculateOrderTotalAmount()}function recalculateOrderTotalAmount(){var e=parseFloat(0);$("input.totalAmountInput").each(function(){e+=parseFloat($(this).val())}),$("#orderTotalAmount").html(e.toFixed(2))}function initCustomerAutocomplete(){var e=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("value"),queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{url:Application.Routes.Orders.GetCustomers+"/?query=%QUERY",wildcard:"%QUERY"}});$(".typeahead").typeahead(null,{name:"customers",displayKey:"Value",source:e,limit:10,highlight:!0}).on("typeahead:select",function(e,r){$("#OrderForm_CustomerId").val(r.id)}),$("input.tt-hint").removeAttr("data-val data-val-required data-val-maxlength data-val-maxlength-max")}function SearchOrdersController(){var e=this;e.init=function(){$("#OrderSearchForm").on("submit",e.executeSearch),$(document).on("click","button.approveOrder",e.approveOrder),$(document).on("click","button.closeOrder",e.closeOrder)},e.executeSearch=function(e){e.preventDefault(),e.returnValue=!1;var r=$(e.target);$.post(r.attr("action"),r.serialize(),function(e){$("#orderSearchResults").html(e)})},e.approveOrder=function(e){var r=$(e.target),t=r.parents("tr:first"),a=t.attr("data-order-id"),o=t.attr("data-order-number");e.preventDefault(),Application.showConfirmation(Application.messages.orderApproveConfirmationText.replace("{0}",o),Application.messages.orderApproveConfirmationTitle,function(){$.post(Application.Routes.Orders.Approve,{orderId:a},function(e){t.replaceWith(e)}).fail(function(e,r,t){Application.showError(t,Application.messages.orderApproveFailedTitle)})})},e.closeOrder=function(e){var r=$(e.target),t=r.parents("tr:first"),a=t.attr("data-order-id"),o=t.attr("data-order-number");e.preventDefault(),Application.showConfirmation(Application.messages.orderCloseConfirmationText.replace("{0}",o),Application.messages.orderCloseConfirmationTitle,function(){$.post(Application.Routes.Orders.Close,{orderId:a},function(e){t.replaceWith(e)}).fail(function(e,r,t){Application.showError(t,Application.messages.orderCloseFailedTitle)})})}}var Application;$(function(){Application=new ApplicationController,Application.init()}),$.extend($.validator.unobtrusive,{rebindForm:function(){var e=$("form");e.removeData("validator"),e.removeData("unobtrusiveValidation"),$.validator.unobtrusive.parse("form"),this.setupBootstrapValidation(e)},escapeAttributeValue:function(e){return e.replace(/([!"#$%&'()*+,.\/:;<=>?@\[\\\]^`{|}~])/g,"\\$1")},setupBootstrapValidation:function(e){e.data("validator").settings.errorPlacement=function(e,r){var t=$("form").find("[data-valmsg-for='"+$.validator.unobtrusive.escapeAttributeValue(r[0].name)+"']"),a=t.attr("data-valmsg-replace");a?$.parseJSON(a)!==!1:null;t.removeClass("field-validation-valid").addClass("field-validation-error"),e.data("unobtrusiveContainer",t),e.hide()},e.data("validator").settings.highlight=function(e,r,t){$(e).closest(".control-group").addClass("error")},e.data("validator").settings.unhighlight=function(e,r,t){$(e).closest(".control-group").removeClass("error")},e.unbind("invalid-form.validate"),e.bind("invalid-form.validate",function(e,r){var t=$("form").find("[data-valmsg-summary=true]"),a=t.find("ul");a&&a.length&&r.errorList.length&&(a.empty(),t.addClass("validation-summary-errors").removeClass("validation-summary-valid"),t.addClass("alert alert-error"),0==t.find("span#validationSummaryHeader").length&&t.prepend("<span class='alert-heading' id='validationSummaryHeader'><strong>"+Application.messages.validationErrorsDivHeader+"</strong></span>"),$.each(r.errorList,function(){$("<li />").html(this.message).appendTo(a)}))}),e.unbind("reset.unobtrusiveValidation"),e.bind("reset.unobtrusiveValidation",function(e){var r=$("form");r.data("validator").resetForm(),r.find(".validation-summary-errors").addClass("validation-summary-valid").removeClass("validation-summary-errors").removeClass("alert alert-error").remove("span#validationSummaryHeader"),r.find(".field-validation-error").addClass("field-validation-valid").removeClass("field-validation-error").removeData("unobtrusiveContainer").find(">*").removeData("unobtrusiveContainer")}),$.validator.methods.number=function(e,r){return NaN!==Globalize.parseFloat(e)?!0:!1},$.validator.methods.date=function(e,r){return null!==Globalize.parseDate(e)?!0:!1}}});var Messages=Messages||{translations:[]};Messages.translations["en-GB"]={validationErrorsDivHeader:"Please correct the following errors:",yes:"Yes",no:"No",ok:"OK",claimApproveConfirmationText:"Are you sure you want to approve claim {0}?",claimApproveConfirmationTitle:"Claim approval",claimApproveFailedTitle:"Claim approval failed",claimRejectConfirmationText:"Are you sure you want to reject claim {0}?",claimRejectConfirmationTitle:"Claim rejection",claimRejectFailedTitle:"Claim rejection failed",orderApproveConfirmationText:"Are you sure you want to approve order {0}?",orderApproveConfirmationTitle:"Order approval",orderApproveFailedTitle:"Order approval failed",orderCloseConfirmationText:"Are you sure you want to close order {0}?",orderCloseConfirmationTitle:"Order closing",orderCloseFailedTitle:"Order closing failed"};var Messages=Messages||{translations:{}};Messages.translations["pl-PL"]={validationErrorsDivHeader:"Proszę poprawić następujące błędy:",yes:"Tak",no:"Nie",ok:"OK",claimApproveConfirmationText:"Czy na pewno chcesz zaakceptować szkodę {0}?",claimApproveConfirmationTitle:"Akceptacja szkody",claimApproveFailedTitle:"Akceptacja szkody nie powiodła się",claimRejectConfirmationText:"Czy na pewno chcesz odrzucić szkodę {0}?",claimRejectConfirmationTitle:"Odrzucenie szkody",claimRejectFailedTitle:"Odrzucenie szkody nie powiodło się",orderApproveConfirmationText:"Czy na pewno chcesz zaakceptować zamówienie {0}?",orderApproveConfirmationTitle:"Akceptacja zamówienia",orderApproveFailedTitle:"Akceptacja zamówienia nie powiodła się",orderCloseConfirmationText:"Czy na pewno chcesz zamknąć zamówienie {0}?",orderCloseConfirmationTitle:"Zamykanie zamówienia",orderCloseFailedTitle:"Zamknięcie zamówienia nie powiodło się"},OrderFormController.OrderFormControllerModes={CREATE:0,EDIT:1};